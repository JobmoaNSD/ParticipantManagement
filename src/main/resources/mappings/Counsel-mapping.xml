<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="CounselDAO">
    <!-- 상담사 정보 업데이트용 쿼리 -->
    <update id="counselUpdate">
        UPDATE
            J_참여자관리
        SET
            취업역량 = #{counselJobSkill},
            최근상담일 = #{counselLastCons},
            진행단계 = #{counselProgress},
            초기상담일 = #{counselInItCons},
            구직만료일 = #{counselJobEX},
            IAP수료일 = #{counselIAPDate},
            [3단계진입일] = #{counselStepPro},
            기간만료일 = #{counselEXPDate},
            클리닉실시일 = #{counselClinic},
            희망직무 = #{counselJobWant},
            희망급여 = #{counselSalWant},
            알선요청 = #{counselPlacement},
            중단종료일 = #{counselEndDate}
        WHERE
            구직번호 = #{counselJobNo}
    </update>

    <!-- 취업정보에서 참여유형 업데이트할때 사용할 쿼리 -->
    <update id="counselUpdateProgress">
        UPDATE
            J_참여자관리
        SET
            진행단계 = #{counselProgress}
        WHERE
            구직번호=#{counselJobNo}
    </update>

    <!-- 상담정보 하나 확인용 쿼리 -->
    <select id="counselSelectOne" resultType="counsel">
        SELECT
            구직번호 AS counselJobNo,
            취업역량 AS counselJobSkill,
            CASE
                WHEN 최근상담일 >= DATEADD(YEAR, -100, GETDATE()) THEN 최근상담일
                END AS counselLastCons,
            진행단계 AS counselProgress,
            CASE
                WHEN 초기상담일 >= DATEADD(YEAR, -100, GETDATE()) THEN 초기상담일
                END AS counselInItCons,
            CASE
                WHEN 구직만료일 >= DATEADD(YEAR, -100, GETDATE()) THEN 구직만료일
                END AS counselJobEX,
            CASE
                WHEN IAP수료일 >= DATEADD(YEAR, -100, GETDATE()) THEN IAP수료일
                END AS counselIAPDate,
            CASE
                WHEN [3단계진입일] >= DATEADD(YEAR, -100, GETDATE()) THEN [3단계진입일]
                END AS counselStepPro,
            CASE
                WHEN 기간만료일 >= DATEADD(YEAR, -100, GETDATE()) THEN 기간만료일
                END AS counselEXPDate,
            CASE
                WHEN 중단종료일 >= DATEADD(YEAR, -100, GETDATE()) THEN 중단종료일
                END AS counselEndDate,
            CASE
                WHEN 클리닉실시일 >= DATEADD(YEAR, -100, GETDATE()) THEN 클리닉실시일
                END AS counselClinic,
            희망직무 AS counselJobWant,
            희망급여 AS counselSalWant,
            알선요청 AS counselPlacement
        FROM
            J_참여자관리
        WHERE
            구직번호=#{counselJobNo}
    </select>

    <!-- -->
    <select id="counselSelectOneEmployment" resultType="counsel">
        SELECT
            구직번호 AS counselJobNo,
            진행단계 AS counselProgress
        FROM
            J_참여자관리
        WHERE
            구직번호=#{counselJobNo}
    </select>


</mapper>