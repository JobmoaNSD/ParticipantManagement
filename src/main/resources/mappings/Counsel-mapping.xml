<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="CounselDAO">
    <!-- 상담사 정보 저장용 쿼리 -->
    <insert id="counselInsert">
        INSERT INTO J_COUNSEL
        (JOBNO, JOBSKILL, LASTCONS, PROGRESS, SUC_U, INITCONS, JOBEX, IAPDATE, STEPAPPRO, EXPDATE, CLINIC, JOBWANT, SALWANT)
        VALUES
            (
                #{counselJobNo},
                #{counselJobSkill},
                #{counselLastCons},
                #{counselProgress},
                #{counselSUCU},
                #{counselInItCons},
                #{counselJobEX},
                #{counselIAPDate},
                #{counselStepPro},
                #{counselEXPDate},
                #{counselClinic},
                #{counselJobWant},
                #{counselSalWant}
            )
    </insert>

    <!-- 상담사 정보 업데이트용 쿼리 -->
    <update id="counselUpdate">
        UPDATE
            J_COUNSEL
        SET
            JOBSKILL = #{counselJobSkill},
            LASTCONS = #{counselLastCons},
            PROGRESS = #{counselProgress},
            SUC_U = #{counselSUCU},
            INITCONS = #{counselInItCons},
            JOBEX = #{counselJobEX},
            IAPDATE = #{counselIAPDate},
            STEPAPPRO = #{counselStepPro},
            EXPDATE = #{counselEXPDate},
            CLINIC = #{counselClinic},
            JOBWANT = #{counselJobWant},
            SALWANT = #{counselSalWant}
        WHERE
            COUNSELNO = #{counselCounselNo}
    </update>

    <!-- 취업정보에서 참여유형 업데이트할때 사용할 쿼리 -->
    <update id="counselUpdateProgress">
        UPDATE
            J_COUNSEL
        SET
            PROGRESS = #{counselProgress}
        WHERE
            JOBNO=#{counselJobNo}
    </update>

    <!-- 상담정보 하나 확인용 쿼리 -->
    <select id="counselSelectOne" resultType="counsel">
        SELECT
            COUNSELNO AS counselCounselNo,
            JOBNO AS counselJobNo,
            JOBSKILL AS counselJobSkill,
            CASE
                WHEN LASTCONS >= DATEADD(YEAR, -100, GETDATE()) THEN LASTCONS
                END AS counselLastCons,
            PROGRESS AS counselProgress,
            SUC_U AS counselSUCU,
            CASE
                WHEN INITCONS >= DATEADD(YEAR, -100, GETDATE()) THEN INITCONS
                END AS counselInItCons,
            CASE
                WHEN JOBEX >= DATEADD(YEAR, -100, GETDATE()) THEN JOBEX
                END AS conselJobEX,
            CASE
                WHEN IAPDATE >= DATEADD(YEAR, -100, GETDATE()) THEN IAPDATE
                END AS counselIAPDate,
            CASE
                WHEN STEPAPPRO >= DATEADD(YEAR, -100, GETDATE()) THEN STEPAPPRO
                END AS counselStepPro,
            CASE
                WHEN EXPDATE >= DATEADD(YEAR, -100, GETDATE()) THEN EXPDATE
                END AS counselEXPDate,
            CASE
                WHEN CLINIC >= DATEADD(YEAR, -100, GETDATE()) THEN CLINIC
                END AS counselClinic,
            JOBWANT AS counselJobWant,
            SALWANT AS counselSalWant
        FROM
            J_COUNSEL
        WHERE
            JOBNO=#{counselJobNo}
    </select>

    <!-- -->
    <select id="counselSelectOneEmployment" resultType="counsel">
        SELECT
            COUNSELNO AS counselCounselNo,
            JOBNO AS counselJobNo,
            PROGRESS AS counselProgress
        FROM
            J_COUNSEL
        WHERE
            JOBNO=#{counselJobNo}
    </select>


</mapper>