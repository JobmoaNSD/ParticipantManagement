<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ParticipantDAO">
    <!-- 검색용 쿼리 -->
    <select id="selectAllParticipantBasic" resultType="participant">
        SELECT TOP (#{pageRows})
            participantJobNo,
            participantPartic,
            participantGender,
            participantLastCons,
            participantProgress,
            participantDob,
            participantRegDate,
            participantClose
        FROM (
                 SELECT
                     ROW_NUMBER() OVER (ORDER BY ParticipantJobNo DESC) AS RowNum,
                     ParticipantJobNo,
                     ParticipantPartic,
                     ParticipantGender,
                     CASE
                         WHEN ParticipantLastCons >= DATEADD(YEAR, -100, GETDATE()) THEN ParticipantLastCons
                         END AS ParticipantLastCons,
                     ParticipantProgress,
                     CASE
                         WHEN ParticipantDob >= DATEADD(YEAR, -100, GETDATE()) THEN ParticipantDob
                         END AS ParticipantDob,
                     CASE
                         WHEN ParticipantRegDate >= DATEADD(YEAR, -100, GETDATE()) THEN ParticipantRegDate
                         END AS ParticipantRegDate,
                     ParticipantClose
                 FROM PARTICIPANTS_VIEW
                 WHERE ParticipantUserid = #{participantUserid} ) AS SUB_QUERY
        WHERE SUB_QUERY.RowNum>#{startPage} AND #{endPage} >= SUB_QUERY.RowNum
    </select>

    <select id="selectCountParticipant" resultType="participant">
        SELECT
            COUNT(ParticipantJobNo) totalCount
        FROM PARTICIPANTS_VIEW
        WHERE
            ParticipantUserid = #{participantUserid}
    </select>

</mapper>