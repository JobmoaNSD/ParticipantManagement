<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ParticipantDAO">
    <!-- 기본 쿼리 시작 -->
    <select id="selectAllParticipantBasic" resultType="participant">
        SELECT TOP (#{pageRows})
            participantJobNo,
            participantPartic,
            participantGender,
            participantLastCons,
            participantProgress,
            participantDob,
            participantRegDate,
            participantClose
        FROM (
                 SELECT
                     ROW_NUMBER() OVER (ORDER BY ParticipantJobNo DESC) AS RowNum,
                     ParticipantJobNo,
                     ParticipantPartic,
                     ParticipantGender,
                     CASE
                         WHEN ParticipantLastCons >= DATEADD(YEAR, -100, GETDATE()) THEN ParticipantLastCons
                         END AS ParticipantLastCons,
                     ParticipantProgress,
                     CASE
                         WHEN ParticipantDob >= DATEADD(YEAR, -100, GETDATE()) THEN ParticipantDob
                         END AS ParticipantDob,
                     CASE
                         WHEN ParticipantRegDate >= DATEADD(YEAR, -100, GETDATE()) THEN ParticipantRegDate
                         END AS ParticipantRegDate,
                     ParticipantClose
                 FROM PARTICIPANTS_VIEW
                 WHERE ParticipantUserid = #{participantUserid} ) AS SUB_QUERY
        WHERE SUB_QUERY.RowNum>#{startPage} AND #{endPage} >= SUB_QUERY.RowNum
    </select>

    <select id="selectCountParticipant" resultType="participant">
        SELECT
            COUNT(ParticipantJobNo) totalCount
        FROM PARTICIPANTS_VIEW
        WHERE
            ParticipantUserid = #{participantUserid}
    </select>
    <!-- 기본 쿼리 끝 -->

    <!-- 검색 쿼리 시작 -->
    <select id="selectAllParticipantSearch" resultType="participant">
        SELECT TOP (#{pageRows})
            participantJobNo,
            participantPartic,
            participantGender,
            participantLastCons,
            participantProgress,
            participantDob,
            participantRegDate,
            participantClose
        FROM (
                 SELECT
                     ROW_NUMBER() OVER (ORDER BY ParticipantJobNo DESC) AS RowNum,
                     ParticipantJobNo,
                     ParticipantPartic,
                     ParticipantGender,
                     CASE
                         WHEN ParticipantLastCons >= DATEADD(YEAR, -100, GETDATE()) THEN ParticipantLastCons
                         END AS ParticipantLastCons,
                     ParticipantProgress,
                     CASE
                         WHEN ParticipantDob >= DATEADD(YEAR, -100, GETDATE()) THEN ParticipantDob
                         END AS ParticipantDob,
                     CASE
                         WHEN ParticipantRegDate >= DATEADD(YEAR, -100, GETDATE()) THEN ParticipantRegDate
                         END AS ParticipantRegDate,
                     ParticipantClose
                 FROM PARTICIPANTS_VIEW
                 WHERE ParticipantUserid = #{participantUserid} AND ${searchOption} like '%'+#{search}+'%') AS SUB_QUERY
        WHERE SUB_QUERY.RowNum>#{startPage} AND #{endPage} >= SUB_QUERY.RowNum
    </select>

    <select id="selectCountParticipantSearch" resultType="participant">
        SELECT
            COUNT(ParticipantJobNo) totalCount
        FROM PARTICIPANTS_VIEW
        WHERE
            ParticipantUserid = #{participantUserid} AND ${searchOption} like '%'+#{search}+'%'
    </select>
    <!-- 검색 쿼리 끝 -->

    <!-- 참여자 전체 자격증 확인용 쿼리 시작 -->
    <select id="selectOneParticcertif" resultType="participant">
        SELECT
            COUNT(JOBNO) AS participantCount
        From
            J_PARTICCERTIF
        WHERE
            JOBNO=#{participantJobNo}
    </select>
    <!-- 참여자 전체 자격증 확인용 쿼리 끝 -->

    <!-- 참여자 전체 상담 확인용 쿼리 시작 -->
    <select id="selectOneCounsel" resultType="participant">
        SELECT
            COUNT(JOBNO) AS participantCount
        From
            J_COUNSEL
        WHERE
            JOBNO=#{participantJobNo}
    </select>
    <!-- 참여자 전체 상담 확인용 쿼리 끝 -->

    <!-- 참여자 전체 취업 확인용 쿼리 시작 -->
    <select id="selectOneEmployment" resultType="participant">
        SELECT
            COUNT(JOBNO) AS participantCount
        From
            J_EMPLOYMENT
        WHERE
            JOBNO=#{participantJobNo}
    </select>
    <!-- 참여자 전체 취업 확인용 쿼리 끝 -->

    <!-- 삭제 쿼리 -->
    <!-- 기본 정보 삭제 쿼리 -->
    <delete id="participantBasicDelete">
        DELETE FROM J_BASIC WHERE JOBNO = #{participantJobNo} AND USERID = #{participantUserid}
    </delete>
    <!-- 자격증 정보 삭제 쿼리 -->
    <delete id="participantParticcertifDelete">
        DELETE FROM J_PARTICCERTIF WHERE JOBNO = #{participantJobNo}
    </delete>
    <!-- 상담 정보 삭제 쿼리 -->
    <delete id="participantCounselDelete">
        DELETE FROM J_COUNSEL WHERE JOBNO = #{participantJobNo}
    </delete>
    <!-- 취업 정보 삭제 쿼리 -->
    <delete id="participantEmploymentDelete">
        DELETE FROM J_EMPLOYMENT WHERE JOBNO = #{participantJobNo}
    </delete>
</mapper>